아래는 요청하신 **마니또 모바일 웹앱 PRD(초안)** 입니다.
(Next.js + Supabase, iPhone 스타일 최신 글래스모피즘 UI 기준으로 작성했어요.)

---

## 1. 제품 개요

* **제품명(가칭)**: 글래스 마니또 (Glass Manitto)
* **플랫폼**: 모바일 웹 (Next.js, responsive / PWA 고려)
* **백엔드 / DB**: Supabase (PostgreSQL + Auth + Storage)
* **핵심 컨셉**
  일정 인원과 미션을 사전에 등록해두고, 각 사용자가 로그인 후 “마니또 배정받기” 버튼을 누르면
  **겹치지 않는 마니또 + 겹치지 않는 미션**을 랜덤으로 1개씩 배정받는 서비스.

---

## 2. 목표 & KPI

### 2.1 목표

* 오프라인 모임(동아리, 회사, 스터디 등)에서 **마니또 게임 세팅을 빠르게** 할 수 있는 툴.
* **관리자는 인원/미션 관리와 배정 현황 확인**,
  **사용자는 직관적으로 로그인 후 배정받기**만 하면 되는 UX.

### 2.2 성공 지표 (예시)

* 한 이벤트(라운드)당 **배정 완료율**: 등록된 인원 중 X% 이상이 배정 완료
* **배정 에러(중복 배정/자기 자신 배정) 발생 0건**
* 평균 **배정 소요 시간**: 1분 이내 (사용자 입장에서)

---

## 3. 유저 유형

1. **관리자(Admin)**

   * 인원 등록
   * 미션 등록
   * 배정 현황 조회
   * (선택) 라운드 생성/마감

2. **일반 사용자(User)**

   * 본인 이름으로 회원가입/로그인
   * “마니또 배정받기” 버튼 클릭
   * 배정된 **마니또(타깃)**와 **미션 1개**를 확인

---

## 4. 주요 컨셉 & 제약 조건

1. **마니또 배정 규칙**

   * 각 참가자(사용자)는 **정확히 1명의 마니또 타깃**을 가진다.
   * 한 참가자가 **여러 사람의 타깃이 될 수는 있음** (예: A,B가 모두 C를 마니또로 가질 수 있는지? ⇒ 여기서 “마니또는 각각 절대 겹치면 안되고” 라고 하셨으니, **타깃도 중복 불가**로 해석하겠습니다.)
   * 즉, 한 라운드에서:

     * 각 사람은 **유일한 타깃**을 갖고
     * 각 사람은 **유일한 대상**으로 배정된다.
   * **자기 자신을 마니또로 배정되면 안 됨.**

2. **미션 배정 규칙**

   * 한 참가자는 **정확히 1개 미션**을 가진다.
   * **같은 미션이 여러 사람에게 배정되면 안 됨** (미션 중복 절대 불가).
   * 미션 개수 ≥ 참가자 인원 수 필수.

3. **랜덤성**

   * 배정은 가능한 한 **랜덤**이되, 위 제약 조건을 100% 만족해야 함.
   * 제약을 만족할 수 없는 경우(예: 인원 > 미션 수, 기형적인 수 등)에는 **명확한 오류 메시지**.

4. **라운드 개념 (Event/Round)**

   * 한 번의 마니또 게임 = 하나의 **라운드**로 관리.
   * 관리자 페이지에서:

     * (선택 기능) 라운드 생성 → 해당 라운드에 인원/미션 등록.
   * 사용자 로그인 후 **현재 활성 라운드** 기준으로 배정.

---

## 5. 사용자 흐름 (User Flow)

### 5.1 관리자 플로우

1. **로그인 (Admin)**

   * 관리자용 URL 접근 (예: `/admin`)
   * Supabase Auth로 관리자 계정 로그인

     * (초기 버전은 ID/PW 하드코딩 또는 환경변수 기반 1계정만)

2. **라운드 생성**

   * 버튼: “새 라운드 생성”
   * 필드: 라운드 이름, 설명, 시작일/종료일(옵션)
   * 상태: draft / active / closed

3. **인원 등록하기**

   * 라운드 선택 후 인원 탭
   * 인원 추가 폼:

     * 이름 (필수)
     * 닉네임(옵션)
     * 메모(옵션)
   * 일괄 등록:

     * 텍스트 에어리어에 한 줄당 한 명 이름 입력
     * “일괄 추가” 버튼
   * 등록된 인원 리스트:

     * 이름 / 등록일 / 배정 여부(배정 전/배정 완료) 표시

4. **미션 등록하기**

   * 라운드 선택 후 미션 탭
   * 미션 추가 폼:

     * 미션 내용 (텍스트)
   * 일괄 등록:

     * 텍스트 에어리어에 한 줄당 한 미션
   * 등록된 미션 리스트:

     * 내용 / 배정 여부(남은 미션/배정됨) 표시

5. **현황 보기**

   * 라운드별 현황 페이지
   * 주요 정보:

     * 전체 인원 수 / 배정 완료 인원 수 / 미배정 인원 수
     * 전체 미션 수 / 남은 미션 수
   * 상세 테이블:

     * 사용자 이름
     * 배정된 마니또 이름
     * 배정된 미션 내용
     * 배정 시간
   * (옵션) Excel/CSV 다운로드 버튼

### 5.2 사용자 플로우

1. **접속 & 회원가입**

   * 메인 페이지 접속 (모바일)
   * “시작하기” → 회원가입 페이지
   * 회원가입 방식(요구사항에 맞춰 단순화):

     * 이름 선택 드롭다운 (관리자가 미리 등록한 인원 리스트)
     * 비밀번호 or 간단 인증 정보 (예: 핀 4자리 또는 이메일)
     * 이름 드롭다운으로 선택 → 선택한 이름이 곧 계정 식별자.
   * Supabase Auth 연동:

     * 실제 Auth는 이메일/비번 or magic link로 처리하고
       화면 상에서는 **이름 드롭다운 + 비밀번호** 형태로 매핑 처리 가능
       (초기 버전은 매우 단순하게 “이름 + shared secret” 정도로 해도 됨).

2. **로그인**

   * 로그인 페이지에서:

     * 이름 드롭다운
     * 비밀번호 입력
   * 일치 시 로그인 성공, 홈으로 이동.

3. **마니또 배정받기**

   * 홈 화면:

     * “아직 마니또가 배정되지 않았어요.” 메시지
     * 큰 CTA 버튼: “마니또 배정받기”
   * 버튼 클릭 시:

     * 서버(또는 Supabase Edge Function)에서 배정 로직 수행
     * 성공 시:

       * “당신의 마니또는 [OOO]입니다.”
       * “당신이 수행해야 할 미션: [미션 내용]”
   * 재접속 시:

     * 이미 배정된 상태라면, 동일 정보 재표시 (새로 배정 X)

4. **내 정보 보기**

   * 마이페이지:

     * 내 이름
     * 배정된 마니또 이름
     * 배정된 미션 내용
     * (옵션) 라운드 정보 (라운드 이름, 설명, 기간)

---

## 6. 기능 요구사항 상세

### 6.1 관리자 페이지

#### 6.1.1 인원 등록하기

* 인원 CRUD

  * 생성: 이름 필수
  * 수정: 이름, 메모 변경 가능
  * 삭제: 아직 배정되지 않은 인원만 삭제 허용 (이미 배정된 경우 경고 및 금지)
* 검증

  * 이름 중복 방지 (동일 라운드 내)
  * 미션 수 < 인원 수일 경우 관리자에게 경고

#### 6.1.2 미션 등록하기

* 미션 CRUD

  * 생성: 텍스트 필수
  * 수정: 텍스트 변경 가능 (이미 배정된 미션은 수정시 주의 경고)
  * 삭제: 아직 배정되지 않은 미션만 삭제 허용
* 검증

  * 미션 내용 중복 시 경고 (선택적으로 막을지 여부 – 기본은 허용하되, “각 미션 내용은 가능하면 고유하게 해주세요” 안내 정도)

#### 6.1.3 현황 보기

* 라운드 요약 카드
* 인원/미션 리스트와 배정 상태
* 데이터는 Supabase에서 read-only로 조회
* 필터/검색

  * 이름으로 검색
  * 배정 여부(배정됨 / 배정 안 됨) 필터

---

### 6.2 사용자 페이지

#### 6.2.1 회원가입 / 로그인

* 이름 드롭다운

  * 데이터 출처: 해당 라운드의 `participants` 테이블
  * 이미 계정이 만들어진 사용자는 다시 회원가입 불가 (경고 메시지)
* 인증 로직

  * 최소:

    * 이름 + 비밀번호
    * Supabase Auth에 email 대신 내부적으로 `name@fake.domain` 생성해서 매핑 가능
  * 나중에 간편 로그인 방식으로 확장 가능

#### 6.2.2 마니또 배정받기

* 버튼 클릭 시 동작:

  1. 현재 유저가 이미 배정받았는지 확인

     * 이미 배정됨 → 저장된 결과 그대로 리턴
  2. 배정되지 않은 경우:

     * 사용 가능한 타깃 후보 목록 조회

       * 자기 자신 제외
       * 아직 “타깃으로 배정되지 않은 인원”만 후보
     * 사용 가능한 미션 후보 목록 조회

       * 아직 어떤 사람에게도 배정되지 않은 미션
     * 후보가 부족한 경우:

       * “현재 배정 가능한 마니또/미션이 부족합니다. 관리자를 문의해주세요.” 에러 메시지
     * 후보에서 랜덤으로 1명 + 1 미션 선택
     * 트랜잭션 또는 Row Level Locking으로 경쟁 조건 방지
  3. assignments 테이블에 기록

     * user_id
     * target_user_id
     * mission_id
     * created_at

---

## 7. 랜덤 배정 로직 명세

### 7.1 제약 조건

* 한 라운드 내에서:

  * 각 유저는 **1개의 target_user**만 가짐.
  * 각 유저는 **1개의 mission**만 가짐.
  * 한 target_user는 여러 명의 source_user에게 배정되면 안 됨.
    즉, **모든 유저 쌍 (source → target)이 1:1 매핑** (순열).
  * 각 mission도 1명에게만 배정.

### 7.2 알고리즘 (개요)

1. **사전 조건 확인**

   * 참가자 수 = N
   * 미션 수 = M
   * 조건:

     * N ≥ 2 (자기 자신 제외하고도 선택 가능한 사람 있어야 함)
     * M ≥ N (각 유저에 유니크 미션)
   * 불만족시 관리자에게 에러 노출

2. **전체 라운드 배정(선행 배정, 옵션)**
   (관리자 버튼으로 전체 한번에 배정도 고려 가능)

   * 참가자 리스트를 셔플
   * 순열 생성:

     * 리스트를 랜덤으로 섞고, 인접하게 연결하되, 자기 자신이 안 나오도록 조정
     * 마지막 사람의 타깃이 첫 사람과 중복/self인 경우 재셔플 or swap 알고리즘 사용
   * 미션 리스트도 셔플 후 1:1 매핑

3. **사용자별 지연 배정(lazy assignment)**
   (요구하신 “배정받기 버튼” 기준)
   두 가지 방법이 있음:

   * A안: 라운드 생성 시 전체 배정을 먼저 계산해두고, 사용자에게는 그 결과만 노출
   * B안: 버튼을 누를 때마다 남은 후보 중에서 새로 배정
     → 이 경우 동시성 관리가 중요

   **PRD에서는 안전한 A안을 기본으로 명시:**

   * 관리자 페이지에서 “배정 실행” 버튼을 누름
   * 이 시점에 모든 참가자에 대해 마니또 + 미션 확정
   * 사용자 입장에서는 버튼을 누르면 “숨겨져 있던 결과를 보여주는” 것만 수행
     (사용자 입장에서 랜덤성은 그대로 유지됨)

> 구현 시점에 B안을 쓰고 싶다면, Supabase Row Level Security + Edge Function + transaction 이용해 경쟁 상태 방지 필요.

---

## 8. 데이터 모델(Supabase 테이블 설계 초안)

### 8.1 rounds

* `id` (uuid, PK)
* `name` (text)
* `description` (text, nullable)
* `status` (enum: draft, active, closed)
* `created_at` (timestamp)
* `updated_at` (timestamp)

### 8.2 participants

* `id` (uuid, PK)
* `round_id` (uuid, FK → rounds.id)
* `name` (text) – 유니크 (round_id + name)
* `note` (text, nullable)
* `created_at` (timestamp)

### 8.3 missions

* `id` (uuid, PK)
* `round_id` (uuid, FK)
* `content` (text)
* `created_at` (timestamp)

### 8.4 users (Supabase auth users와 매핑)

* Supabase 기본 `auth.users` 사용
* 별도의 `profiles` 테이블:

  * `id` (uuid, PK, FK → auth.users.id)
  * `round_id` (uuid, FK)
  * `participant_id` (uuid, FK → participants.id)
  * `display_name` (text)

### 8.5 assignments

* `id` (uuid, PK)
* `round_id` (uuid, FK)
* `user_id` (uuid, FK → profiles.id or auth.users.id)
* `source_participant_id` (uuid, FK → participants.id)
* `target_participant_id` (uuid, FK → participants.id)
* `mission_id` (uuid, FK → missions.id)
* `created_at` (timestamp)

**제약조건**

* (round_id, user_id) unique
* (round_id, target_participant_id) unique  → 한 사람은 한 번만 타깃으로 사용
* (round_id, mission_id) unique → 미션 1회만 사용

---

## 9. 화면 / 페이지 구조 (Next.js, App Router 기준)

* `/`

  * 랜딩 & “시작하기” 버튼

* `/signup`

  * 이름 드롭다운 + 비밀번호 입력

* `/login`

  * 이름 드롭다운 + 비밀번호 입력

* `/home` (로그인 필요)

  * 현재 상태 표시 + “마니또 배정받기” 버튼

* `/my`

  * 내 마니또 + 미션 확인

* `/admin`

  * 관리자 로그인/대시보드

* `/admin/rounds`

  * 라운드 리스트 + 생성하기

* `/admin/rounds/[roundId]/participants`

  * 인원 등록 / 리스트

* `/admin/rounds/[roundId]/missions`

  * 미션 등록 / 리스트

* `/admin/rounds/[roundId]/status`

  * 현황 보기 + (선택) “배정 실행” 버튼

---

## 10. UI/UX 가이드 (글래스 모피즘, 모바일)

### 10.1 공통 스타일

* **배경**

  * 다크/블러가 들어간 그라데이션 (예: 파스텔 블루/핑크 계열)
  * iOS 17 느낌의 매우 부드러운 컬러 그라데이션

* **카드 & 패널**

  * 반투명 화이트 (#FFFFFF, opacity ~0.15~0.25)
  * 강한 background blur (backdrop-filter: blur(20–30px))
  * 모서리 radius 크게 (16–24px)
  * 섬세한 1px 테두리 (rgba(255,255,255,0.4) 정도)
  * 미세한 inner shadow로 유리 느낌 강조

* **타이포그래피**

  * 기본 폰트: iOS 기본 시스템 폰트 느낌 (SF Pro 계열)
  * H1: 굵은 볼드, 24–28px
  * 본문: 14–16px

* **버튼**

  * 라운드형 pill 버튼
  * 반투명 + blur 배경
  * 호버/탭 시 살짝 밝게/입체감

### 10.2 주요 화면별 UX 포인트

* **로그인/회원가입**

  * 화면 중앙에 큰 유리 카드 1개
  * 상단에 라운드 이름 또는 앱 로고
  * 이름 드롭다운은 iOS 피커 느낌(하단 모달처럼 해도 좋음)

* **마니또 배정 결과 화면**

  * 결과 텍스트를 **중앙에 큼직하게**
  * “당신의 마니또는 OOO입니다.” 크게 표시
  * 그 아래에 미션 카드: 카드 안에 미션 내용을 강조
  * 약간의 애니메이션:

    * 페이드 인 + 살짝 스케일 업

* **관리자 페이지**

  * 모바일이지만 태블릿/데스크탑 대응도 염두
  * 리스트는 테이블보다는 카드형 리스트
  * 필수 정보만 크게, 나머지는 축소/숨김

---

## 11. 비기능 요구사항

* **성능**

  * 모바일 기준 최초 로딩 3초 이내 (네트워크 상황 보통 가정)
  * 배정 버튼 클릭 후 1초 이내 결과 노출 (이미 계산된 배정값 활용 시 충분)

* **보안**

  * Supabase Auth로 보호된 페이지 분리
  * 관리자 페이지는 별도 role/claim으로 접근 제한
  * RLS(Row Level Security)로 각 사용자는 자기 assignments만 조회 가능

* **확장성**

  * 다수 라운드를 동시에 운영할 수 있도록 설계
  * 추후 라운드별 초대 코드/링크 기능 추가를 고려한 구조

---

## 12. 우선순위 (MVP 범위)

**MVP 필수**

* [x] 라운드 1개 기준, 인원/미션 등록 (관리자)
* [x] 사용자 회원가입/로그인 (이름 드롭다운)
* [x] 마니또 + 미션 랜덤 배정 (전체 사전 배정 or 버튼 기준에서 결정)
* [x] 배정 결과 조회 (사용자)
* [x] 현황 보기 (관리자, read-only)

**MVP 이후(차후 기능)**

* 여러 라운드 동시 운영
* 라운드 초대 코드/URL
* 이메일/카카오 공유 기능
* 마니또 힌트/메시지 주고받기 기능 등

---

필요하면 이 PRD 기준으로 **DB 스키마 SQL**, **Next.js 폴더 구조**, **Supabase Edge Function 의사코드**까지 바로 이어서 정리해줄게요.
혹시 특정 부분(예: 랜덤 배정 알고리즘 구현, UI 디자인 디테일)을 더 깊게 파고싶으면 바로 말해줘!
